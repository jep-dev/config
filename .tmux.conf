##############################################################################
### Environment settings #####################################################
set -g default-shell /usr/bin/zsh #              Default command for new panes
set -g default-terminal "tmux" #                 Default terminal for commands
set -g -a terminal-overrides ',xterm*:smcup@:rmcup@' #    Default term changes
set -g utf8 on #                                                  Support utf8

### Event handling settings ##################################################
setw -g mouse #                                 Enable mouse events in general
set -g @emulate-scroll-for-no-mouse-alternate-buffer "on" #  Hack pager scroll
set -sg escape-time 0 #                                       # Instant escape

### Key bindings #############################################################
# For this section, convert ALL to bind with prefix (no '-n') to avoid
# collisions with shell/pager/editor. Use modifier keys for mnemonics.
##############################################################################

unbind C-b
set -g prefix C-j
bind C-j send-prefix


# <prefix>(r|R) to reset (pane|Tmux)
bind r copy-mode -e \; send -R \; clearhist \; send C-l \; clearhist
bind C-r source ~/.tmux.conf \; display "Reloaded Tmux"

# bind M-m splitw 'echo -n "Man: "; IFS="" read -r i && ~/bin/mangrep $i'
# bind M-M splitw -h 'echo -n "Man: "; IFS="" read -r i && ~/bin/mangrep $i'

# <prefix>Ctrl+(k|l|j|h) adds pane (N|E|S|W)
bind C-k splitw -c -b "#{pane_current_path}"
bind C-l splitw -h -c "#{pane_current_path}"
bind C-j splitw -c "#{pane_current_path}"
bind C-h splitw -h -c -b "#{pane_current_path}"
# <prefix>(k|l|j|h) selects pane (N|E|S|W)
bind k selectp -U
bind l selectp -R
bind j selectp -D
bind h selectp -L
# <prefix>(z|Z) (zooms|breaks) pane
bind Z breakp -t :.
# <prefix>(o|O) rotates panes (CW|CCW)
bind o selectp -t :.+
bind O selectp -t :.-

# Window commands add control key to analogous pane commands where possible
bind C-n neww -c "#{pane_current_path}"
bind C-o next
bind C-O last

# # TODO convention for specific macros?
# # Maybe with an emulated 'second prefix'?
# bind C-m neww -c "#{pane_current_path}" 'make 2>&1 | less'

# # TODO
# # <prefix><t> for dim background windows, shift for restore
# # These should probably be moved to XFCE settings
# bind T run-shell "xfconf-query -c xfwm4 -p /general/inactive_opacity -s 100"
# bind t run-shell "xfconf-query -c xfwm4 -p /general/inactive_opacity -s 40"

# # TODO
# # <alt+;> to pause logging; shift for resume
# bind M-: display-message "Logging enabled (~/.#I_#P.log)" \; \
# 		pipe-pane -o "exec cat >>/home/john/.#I_#P.log"
# bind M-\; display-message "Logging disabled" \; \
# 		pipe-pane

### Status bar format and settings ###########################################
set -g display-time 2500 #                                  # Message duration
set -g status-bg colour232
set -g status-fg colour231
set -g status-utf8 on
set -g window-status-current-format "#(tmux_status)"
set -g status-right "#(tmux_status -r)"
set -g status-interval 3

### Pane format and settings #################################################
setw -g pane-active-border-style fg=default,noreverse,bg=default,noreverse
setw -g pane-border-style fg=white
setw -g pane-border-fg black
setw -g pane-active-border-fg white


### Plugins and settings #####################################################
set -g @plugin 'tmux-plugins/tpm' #                        Tmux Plugin Manager
# set -g @plugin 'tmux-plugins/tmux-resurrect' #     Start session from backup
##############################################################################
set -g @plugin 'nhdaly/tmux-better-mouse-mode' #      Contextual mouse mapping
##############################################################################
# set -g @plugin 'tmux-plugins/tmux-continuum' #               Backup sessions
# set -g @continuum-restore 'on'
# set -g @continuum-save-interval '5'
##############################################################################

run '~/.tmux/plugins/tpm/tpm'
